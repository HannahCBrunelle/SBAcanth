#####Beginning Stages of Playing with SERC Striped Bass Dissection Data#####
#Author: Hannah C Brunelle
#Advisor: Dr.Katrina Lohan
#Date: June 14,2022 - 

#Import data
library(readr)
DissectionsK <- read.csv("~/Desktop/Book6.csv")
View(DissectionsK)
as_tibble(DissectionsK)

DATAYesNo <- read.csv("~/Desktop/Book4.csv")
View(DATAYesNo)
mean(DATAYesNo$ParasiztiedK, na.rm=TRUE)
mean(DATAYesNo$NonParasiztiedK)
mean(DATAYesNo$K, na.rm=TRUE)
sapply(DATAYesNo$NonParasiztiedK, na.rm = TRUE)


#Investigating Data
str(DissectionsK)
head(DissectionsK)

#Preview the Data 
View(DissectionsK)

#Loading in Packages 
library(tidyverse)
library(lubridate)
library(dplyr)
library(ggpubr)
library(janitor)

#ggpubr had an error and it was due to needing an older version in order to use it
install_version("ggpubr", version = "0.2.5", repos = "http://cran.us.r-project.org")
library(ggpubr)

install_version("rstatix", version = "0.2.5", repos = "http://cran.us.r-project.org")
devtools::install_version("cowplot", "0.7.0") # selected option #2
devtools::install_version("car", "3.0-0") # selected option #3 None

#Creating a class of parasitized striped bass (yes/no)
library(tibble)
DissectionsK <- DissectionsK%>%
  add_column(Parasitized = 
               if_else(DissectionsK$Acanthocephalan > 0,"Yes","No"),
             .after="Acanthocephalan")

table(DissectionsK$Parasitized) #Checking out the new class
table(DissectionsK$Acanthocephalan) #making sure all was still all right

#Creating a class of combined Tributaries 
library(tibble)
DissectionsK <- DissectionsK %>%
  mutate(Tributary = case_when(                                #"Class" will be the new column, and "case_when" will give the conditions to populate the column
    endsWith(Tributary, "York_Pamunkey") ~ "York",    #"endsWith: guides where the info is and what value to look for; 
    endsWith(Tributary, "York_Mattaponi") ~ "York", #in this case is looking into "Classification" column and for the value "Cucculanid"
    endsWith(Tributary, "York_Lower") ~ "York",   #the "~Chromadorea" indicates the new value on the new column based on the value in "Classificatio"
    endsWith(Tributary, "Upper_Bay") ~ "Upper_Bay",
    endsWith(Tributary, "Rhode") ~ "Rhode",
    endsWith(Tributary, "Rappahannock_Upper") ~ "Rappahannock",
    endsWith(Tributary, "Rappahannock_Lower") ~ "Rappahannock",
    endsWith(Tributary, "Potomac") ~ "Potomac",
    endsWith(Tributary, "Patuxent") ~ "Patuxent",
    endsWith(Tributary, "Nanticoke") ~ "Nanticoke",
    endsWith(Tributary, "James_Upper") ~ "James",
    endsWith(Tributary, "James_Lower") ~ "James",
    endsWith(Tributary, "Choptank") ~ "Choptank"
  ))

table(DissectionsK$TributaryLocation) #Checking out the new class
table(Parasitized_yes$Tributary) #making sure all was still all right

#Creating a class of combined Month and Seasons 
library(tibble)
DissectionsK <- DissectionsK %>%
  mutate(Season = case_when(                                #"Class" will be the new column, and "case_when" will give the conditions to populate the column
    endsWith(Season, "Spring") ~ "Spring",    #"endsWith: guides where the info is and what value to look for; 
    endsWith(Season, "September") ~ "Fall", #in this case is looking into "Classification" column and for the value "Cucculanid"
    endsWith(Season, "Fall") ~ "Fall",
    endsWith(Season, "Late_Summer") ~ "Late_Summer",
    endsWith(Season, "Late Summer") ~ "Late_Summer",
    endsWith(Season, "August") ~ "Late_Summer",
    endsWith(Season, "July") ~ "Mid_Summer",
    endsWith(Season, "Early_Summer") ~ "Early_Summer"
  ))
table(DissectionsK$Season) #Checking out the new class
table(DissectionsK$Season) #making sure all was still all right

#Creating a class of combined ages
DissectionsK <- DissectionsK %>%
  mutate(Age_Class = case_when(                                #"Class" will be the new column, and "case_when" will give the conditions to populate the column
    endsWith(Age_Class, "Adult") ~ "Adult",    #"endsWith: guides where the info is and what value to look for; 
    endsWith(Age_Class, "Age_1_4") ~ "Age_1_4", #in this case is looking into "Classification" column and for the value "Cucculanid"
    endsWith(Age_Class, "Age_1_4_PossYOY") ~ "Age_1_4",
    endsWith(Age_Class, "YOY") ~ "YOY"
  ))
table(DissectionsK$Age_Class)

######Converting a variable into numeric if for some bizarre reason the data did not read as numerical:######
#A summary of the information within the data set

#TASK 4
summary(DissectionsK) 
table(DissectionsK$K, DissectionsK$ParasiztiedK, DissectionsK$NonParasitizedK)
as.table(DissectionsK$K)

 
#Creating tables with totals using dplyr and janitor functions:
DissectionsK %>% 
  summarise(
    mean = K, ParasiztiedK, NonParasitizedK,
    sd = K, ParasiztiedK, NonParasitizedK )

group_by(DissectionsK, Parasitized) %>%  #indicates that I am grouping the dataset "YOY" by the various "Classification"
  summarise(                       #Being summarized by meand and sd.
    mean = mean(K),
    sd = sd(K)
  ) 

#for some reason some of the numerical variables are showing as character
#Converting to numeric
DissectionsK$FL_mm <- as.numeric(as.character(DissectionsK$FL_mm)) 
DissectionsK$Acanthocephalan <- as.numeric(as.factor(DissectionsK$Acanthocephalan))
Parasitized_yes$K <- as.numeric(as.character(Parasitized_yes$K))
DissectionsK$BodyWWt_g <- as.numeric(as.character(DissectionsK$BodyWWt_g))
DissectionsK$TL_mm <- as.numeric(as.character(DissectionsK$TL_mm))
DissectionsK$TL_cm <- as.numeric(as.character(DissectionsK$TL_cm))
DissectionsK$FL_cm <- as.numeric(as.character(DissectionsK$FL_mm))
DissectionsK$Season <- as.character(as.factor(DissectionsK$Season))
DissectionsK$Tributary <- as.character(as.factor(DissectionsK$Tributary))
DissectionsK$Age_Class <- as.character(as.factor(DissectionsK$Age_Class))
DATAYesNo$NonParasitizedK <- as.numeric(as.numeric(DATAYesNo$NonParasitizedK))

table(DissectionsK$Age_Class) #Checking out the new class
table(DissectionsK$Age_Class) #making sure all was still all right

#Check if it worked with:
DissectionsK 

#Changing the Tributary Order

#Reorder a factor to desired way for Boxplots
DissectionsK$Tributary_Main <- fct_relevel(DissectionsK$Tributary_Main,"James","York","Rappahannock","Potomac","Nanticoke", "Patuxent","Choptank", "Rhode", "Upper_Bay")
#Reorder a factor to desired way for Prevalence  
DissectionsK$Tributary_Main <- fct_relevel(DissectionsK$Tributary_Main,"Upper_Bay","Rhode","Choptank","Patuxent","Nanticoke","Potomac","Rappahannock","York","James")
